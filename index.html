<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Apalucha GPS Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    backgroundImage: {
                        'bike-gradient': 'linear-gradient(135deg, #064e3b 0%, #10b981 50%, #34d399 100%)',
                    },
                    colors: {
                        'bike-primary': '#10b981',
                        'bike-secondary': '#34d399',
                        'bike-accent': '#f59e0b',
                        'bike-dark': '#064e3b',
                        'bike-light': '#ecfdf5',
                    },
                    animation: {
                        'pulse-slow': 'pulse-slow 2s ease-in-out infinite',
                        'bounce-slow': 'bounce-slow 1s ease-in-out infinite',
                    },
                    keyframes: {
                        'pulse-slow': {
                            '0%, 100%': { opacity: '1' },
                            '50%': { opacity: '0.7' },
                        },
                        'bounce-slow': {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' },
                        },
                    }
                }
            }
        }
    </script>
    <style>
        .custom-gradient {
            background: linear-gradient(135deg, #064e3b 0%, #10b981 50%, #34d399 100%);
        }
        .glass-effect {
            background: rgba(6, 78, 59, 0.5);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .animate-pulse-slow {
            animation: pulse-slow 2s ease-in-out infinite;
        }
        .animate-bounce-slow {
            animation: bounce-slow 1s ease-in-out infinite;
        }
        @keyframes pulse-slow {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        @keyframes bounce-slow {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        .btn-primary {
            background: #34d399;
            color: black;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        .btn-primary:hover {
            background: rgba(52, 211, 153, 0.8);
        }
        .btn-primary:disabled {
            background: rgba(52, 211, 153, 0.3);
            cursor: not-allowed;
        }
        .btn-outline {
            border: 1px solid #f59e0b;
            color: #f59e0b;
            background: transparent;
            transition: all 0.3s ease;
        }
        .btn-outline:hover {
            background: #f59e0b;
            color: white;
        }
        .btn-destructive {
            background: #ef4444;
            color: white;
        }
        .btn-destructive:hover {
            background: #dc2626;
        }
        .badge {
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 500;
        }
        .badge-secondary {
            background: rgba(52, 211, 153, 0.2);
            color: #34d399;
        }
        .badge-destructive {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }
        .badge-outline {
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: rgba(255, 255, 255, 0.7);
        }
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(6, 78, 59, 0.9);
            color: white;
            padding: 1rem;
            border-radius: 0.5rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
            max-width: 400px;
            z-index: 1000;
            animation: slideIn 0.3s ease-out;
        }
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        .icon {
            width: 1.25rem;
            height: 1.25rem;
            display: inline-block;
            stroke: currentColor;
            fill: none;
            stroke-width: 2;
            line-cap: round;
            line-join: round;
        }
        .icon-lg {
            width: 2rem;
            height: 2rem;
        }
        .icon-xl {
            width: 3rem;
            height: 3rem;
        }
    </style>
</head>
<body class="min-h-screen custom-gradient text-white">
    <div class="max-w-4xl mx-auto p-4 space-y-6">
        
        <!-- Header -->
        <div class="text-center space-y-2">
            <div class="flex items-center justify-center gap-3">
                <svg class="icon-lg text-bike-secondary" viewBox="0 0 24 24">
                    <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                    <circle cx="12" cy="10" r="3"></circle>
                </svg>
                <h1 class="text-4xl font-bold">Apalucha GPS Tracker</h1>
            </div>
            <div class="flex items-center justify-center gap-4">
                <span id="gpsStatus" class="badge badge-destructive animate-pulse-slow">
                    GPS OFFLINE
                </span>
                <span id="gpsAccuracy" class="text-sm text-white/70" style="display: none;">
                    Přesnost: -m
                </span>
            </div>
        </div>

        <!-- Current Position Card -->
        <div class="glass-effect rounded-lg">
            <div class="p-6">
                <h3 class="font-semibold text-bike-secondary flex items-center gap-2 mb-4">
                    <svg class="icon" viewBox="0 0 24 24">
                        <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                        <circle cx="12" cy="10" r="3"></circle>
                    </svg>
                    Aktuální poloha
                </h3>
                
                <div id="positionDisplay">
                    <div class="text-center py-8">
                        <svg class="icon-xl mx-auto mb-4 text-white/50 animate-bounce-slow" viewBox="0 0 24 24">
                            <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                            <circle cx="12" cy="10" r="3"></circle>
                        </svg>
                        <p class="text-white/70">Čekání na GPS signál...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Stats Cards -->
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
            <div class="glass-effect rounded-lg">
                <div class="p-4 text-center">
                    <div id="totalDistance" class="text-2xl font-bold text-bike-secondary">0.00</div>
                    <div class="text-xs text-white/70">Celková vzdálenost (km)</div>
                </div>
            </div>
            
            <div class="glass-effect rounded-lg">
                <div class="p-4 text-center">
                    <div id="totalTime" class="text-2xl font-bold text-bike-accent">00:00:00</div>
                    <div class="text-xs text-white/70 flex items-center justify-center gap-1">
                        <svg class="icon" style="width: 0.75rem; height: 0.75rem;" viewBox="0 0 24 24">
                            <circle cx="12" cy="12" r="10"></circle>
                            <polyline points="12,6 12,12 16,14"></polyline>
                        </svg>
                        Celkový čas
                    </div>
                </div>
            </div>
            
            <div class="glass-effect rounded-lg">
                <div class="p-4 text-center">
                    <div id="maxSpeed" class="text-2xl font-bold text-white">0.0</div>
                    <div class="text-xs text-white/70">Max rychlost (km/h)</div>
                </div>
            </div>
            
            <div class="glass-effect rounded-lg">
                <div class="p-4 text-center">
                    <div id="avgSpeed" class="text-2xl font-bold text-white">0.0</div>
                    <div class="text-xs text-white/70">Průměr (km/h)</div>
                </div>
            </div>
        </div>

        <!-- Route Info -->
        <div class="glass-effect rounded-lg">
            <div class="p-6">
                <h3 class="font-semibold text-bike-accent flex items-center gap-2 mb-4">
                    <svg class="icon" viewBox="0 0 24 24">
                        <polyline points="4,9 7,6 11,10 15,6 20,11"></polyline>
                        <path d="M3 21h18"></path>
                    </svg>
                    Informace o trase
                </h3>
                
                <div class="space-y-2 text-sm">
                    <div class="flex justify-between">
                        <span class="text-white/70">Body trasy:</span>
                        <span id="routePoints" class="font-mono">0</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-white/70">Status:</span>
                        <span id="trackingStatus" class="badge badge-outline text-xs">Neaktivní</span>
                    </div>
                    
                    <div id="routeStart" class="mt-4 p-3 bg-white/5 rounded" style="display: none;">
                        <div class="text-xs text-white/70 mb-2">Začátek trasy:</div>
                        <div id="startCoords" class="font-mono text-sm"></div>
                        <div id="startTime" class="text-xs text-white/50"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Control Buttons -->
        <div class="space-y-3">
            <button id="startBtn" class="w-full btn-primary py-4 text-lg rounded-lg disabled:opacity-50" disabled>
                <span class="flex items-center justify-center gap-2">
                    <svg class="icon" viewBox="0 0 24 24">
                        <polygon points="5,3 19,12 5,21"></polygon>
                    </svg>
                    Začít sledování GPS
                </span>
            </button>
            
            <div id="activeControls" class="grid grid-cols-2 gap-3" style="display: none;">
                <button id="pauseBtn" class="btn-outline py-4 rounded-lg">
                    <span class="flex items-center justify-center gap-2">
                        <svg class="icon" viewBox="0 0 24 24">
                            <rect x="6" y="4" width="4" height="16"></rect>
                            <rect x="14" y="4" width="4" height="16"></rect>
                        </svg>
                        Pozastavit
                    </span>
                </button>
                
                <button id="stopBtn" class="btn-destructive py-4 rounded-lg">
                    <span class="flex items-center justify-center gap-2">
                        <rect x="6" y="6" width="12" height="12" rx="2"></rect>
                    </span>
                    Ukončit
                </button>
            </div>
            
            <button id="resetBtn" class="w-full border border-white/30 text-white/70 hover:bg-white/10 py-3 rounded-lg transition-all disabled:opacity-50" disabled>
                <span class="flex items-center justify-center gap-2">
                    <svg class="icon" viewBox="0 0 24 24">
                        <polyline points="1,4 1,10 7,10"></polyline>
                        <path d="M3.51,15a9,9,0,0,0,15.92-8.63L7,10"></path>
                    </svg>
                    Vymazat všechna data
                </span>
            </button>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toastContainer"></div>

    <script>
        console.log("Apalucha GPS Tracker initializing");
        
        let isTracking = false;
        let isPaused = false;
        let currentPosition = null;
        let route = [];
        let stats = {
            distance: 0,
            duration: 0,
            maxSpeed: 0,
            avgSpeed: 0,
            currentSpeed: 0
        };
        let gpsAccuracy = null;
        let isGpsEnabled = false;
        let lastUpdateTime = '';
        
        let watchId = null;
        let startTime = null;
        let lastPosition = null;

        // Toast function
        function showToast(title, description, variant = 'default') {
            console.log(`Toast: ${title} - ${description}`);
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.innerHTML = `
                <div class="font-semibold">${title}</div>
                <div class="text-sm opacity-90">${description}</div>
            `;
            
            document.getElementById('toastContainer').appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 4000);
        }

        // Distance calculation
        function calculateDistance(pos1, pos2) {
            const R = 6371000; // Earth's radius in meters
            const dLat = (pos2.lat - pos1.lat) * Math.PI / 180;
            const dLon = (pos2.lng - pos1.lng) * Math.PI / 180;
            const a = 
                Math.sin(dLat/2) * Math.sin(dLat/2) +
                Math.cos(pos1.lat * Math.PI / 180) * Math.cos(pos2.lat * Math.PI / 180) * 
                Math.sin(dLon/2) * Math.sin(dLon/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c;
        }

        // Update stats
        function updateStats(newPosition) {
            console.log("Updating stats with new position:", newPosition);
            
            const now = Date.now();
            const currentSpeed = newPosition.speed ? newPosition.speed * 3.6 : 0; // Convert m/s to km/h
            
            let newDistance = stats.distance;
            
            if (lastPosition) {
                const segmentDistance = calculateDistance(lastPosition, newPosition);
                newDistance += segmentDistance;
            }
            
            const duration = startTime ? (now - startTime) / 1000 : 0;
            const maxSpeed = Math.max(stats.maxSpeed, currentSpeed);
            const avgSpeed = duration > 0 ? (newDistance / 1000) / (duration / 3600) : 0;
            
            stats = {
                distance: newDistance,
                duration,
                maxSpeed,
                avgSpeed,
                currentSpeed
            };
            
            updateUI();
        }

        // Format time
        function formatTime(seconds) {
            const hrs = Math.floor(seconds / 3600);
            const mins = Math.floor((seconds % 3600) / 60);
            const secs = Math.floor(seconds % 60);
            return `${hrs.toString().padStart(2, '0')}:${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }

        // Format coordinates
        function formatCoordinates(lat, lng) {
            return `${lat.toFixed(6)}, ${lng.toFixed(6)}`;
        }

        // Update UI
        function updateUI() {
            // Update position display
            if (currentPosition) {
                document.getElementById('positionDisplay').innerHTML = `
                    <div class="space-y-3">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <div class="text-sm text-white/70">Souřadnice</div>
                                <div class="font-mono text-lg">
                                    ${formatCoordinates(currentPosition.lat, currentPosition.lng)}
                                </div>
                            </div>
                            <div>
                                <div class="text-sm text-white/70">Poslední aktualizace</div>
                                <div class="font-mono text-lg">${lastUpdateTime}</div>
                            </div>
                        </div>
                        
                        <div class="mt-4 p-4 bg-white/5 rounded-lg">
                            <div class="text-center">
                                <div class="text-3xl font-bold text-bike-secondary">
                                    ${stats.currentSpeed.toFixed(1)}
                                </div>
                                <div class="text-sm text-white/70">km/h aktuální rychlost</div>
                            </div>
                        </div>
                    </div>
                `;
            }

            // Update stats
            document.getElementById('totalDistance').textContent = (stats.distance / 1000).toFixed(2);
            document.getElementById('totalTime').textContent = formatTime(stats.duration);
            document.getElementById('maxSpeed').textContent = stats.maxSpeed.toFixed(1);
            document.getElementById('avgSpeed').textContent = stats.avgSpeed.toFixed(1);
            
            // Update route info
            document.getElementById('routePoints').textContent = route.length;
            
            const statusEl = document.getElementById('trackingStatus');
            if (isTracking) {
                statusEl.textContent = isPaused ? 'Pozastaveno' : 'Aktivní';
                statusEl.className = isPaused ? 'badge badge-secondary text-xs' : 'badge badge-outline text-xs';
            } else {
                statusEl.textContent = 'Neaktivní';
                statusEl.className = 'badge badge-outline text-xs';
            }
            
            // Show route start if exists
            if (route.length > 0) {
                document.getElementById('routeStart').style.display = 'block';
                document.getElementById('startCoords').textContent = formatCoordinates(route[0].lat, route[0].lng);
                document.getElementById('startTime').textContent = new Date(route[0].timestamp).toLocaleString();
            } else {
                document.getElementById('routeStart').style.display = 'none';
            }
            
            // Update controls
            document.getElementById('startBtn').style.display = isTracking ? 'none' : 'block';
            document.getElementById('activeControls').style.display = isTracking ? 'grid' : 'none';
            document.getElementById('resetBtn').disabled = isTracking;
            
            const pauseBtn = document.getElementById('pauseBtn');
            if (isPaused) {
                pauseBtn.innerHTML = `
                    <span class="flex items-center justify-center gap-2">
                        <svg class="icon" viewBox="0 0 24 24">
                            <polygon points="5,3 19,12 5,21"></polygon>
                        </svg>
                        Pokračovat
                    </span>
                `;
            } else {
                pauseBtn.innerHTML = `
                    <span class="flex items-center justify-center gap-2">
                        <svg class="icon" viewBox="0 0 24 24">
                            <rect x="6" y="4" width="4" height="16"></rect>
                            <rect x="14" y="4" width="4" height="16"></rect>
                        </svg>
                        Pozastavit
                    </span>
                `;
            }
        }

        // Start tracking
        function startTracking() {
            console.log("Starting GPS tracking");
            
            if (!navigator.geolocation) return;
            
            isTracking = true;
            isPaused = false;
            startTime = Date.now();
            
            watchId = navigator.geolocation.watchPosition(
                (position) => {
                    console.log("GPS position update:", position.coords);
                    
                    const newPos = {
                        lat: position.coords.latitude,
                        lng: position.coords.longitude,
                        timestamp: Date.now(),
                        speed: position.coords.speed || 0
                    };
                    
                    currentPosition = newPos;
                    gpsAccuracy = position.coords.accuracy;
                    lastUpdateTime = new Date().toLocaleTimeString();
                    
                    if (!isPaused) {
                        route.push(newPos);
                        updateStats(newPos);
                        lastPosition = newPos;
                    }
                    
                    updateUI();
                },
                (error) => {
                    console.error("GPS tracking error:", error);
                    showToast("GPS chyba během sledování", error.message, "destructive");
                },
                { 
                    enableHighAccuracy: true, 
                    timeout: 5000, 
                    maximumAge: 1000 
                }
            );
            
            updateUI();
            showToast("Sledování zahájeno", "GPS tracking je aktivní");
        }

        // Pause tracking
        function pauseTracking() {
            console.log("Pausing GPS tracking");
            isPaused = !isPaused;
            
            updateUI();
            showToast(
                isPaused ? "Sledování pozastaveno" : "Sledování obnoveno",
                isPaused ? "GPS tracking je pozastaven" : "GPS tracking pokračuje"
            );
        }

        // Stop tracking
        function stopTracking() {
            console.log("Stopping GPS tracking");
            
            if (watchId) {
                navigator.geolocation.clearWatch(watchId);
            }
            
            isTracking = false;
            isPaused = false;
            startTime = null;
            lastPosition = null;
            
            updateUI();
            showToast("Sledování ukončeno", `Celková vzdálenost: ${(stats.distance / 1000).toFixed(2)} km`);
        }

        // Reset tracking
        function resetTracking() {
            console.log("Resetting GPS tracking data");
            
            stopTracking();
            route = [];
            stats = {
                distance: 0,
                duration: 0,
                maxSpeed: 0,
                avgSpeed: 0,
                currentSpeed: 0
            };
            
            updateUI();
            showToast("Data vymazána", "Všechny záznamy byly smazány");
        }

        // Initialize GPS
        function initGPS() {
            console.log("Checking GPS availability");
            
            if (!navigator.geolocation) {
                showToast("GPS není podporováno", "Váš prohlížeč nepodporuje geolokaci", "destructive");
                return;
            }

            // Get initial position
            navigator.geolocation.getCurrentPosition(
                (position) => {
                    console.log("Initial GPS position obtained:", position.coords);
                    const newPos = {
                        lat: position.coords.latitude,
                        lng: position.coords.longitude,
                        timestamp: Date.now(),
                        speed: position.coords.speed || 0
                    };
                    currentPosition = newPos;
                    gpsAccuracy = position.coords.accuracy;
                    isGpsEnabled = true;
                    lastUpdateTime = new Date().toLocaleTimeString();
                    
                    // Update GPS status
                    document.getElementById('gpsStatus').textContent = 'GPS AKTIVNÍ';
                    document.getElementById('gpsStatus').className = 'badge badge-secondary animate-pulse-slow';
                    document.getElementById('gpsAccuracy').style.display = 'inline';
                    document.getElementById('gpsAccuracy').textContent = `Přesnost: ${Math.round(position.coords.accuracy)}m`;
                    
                    // Enable start button
                    document.getElementById('startBtn').disabled = false;
                    
                    updateUI();
                    showToast("GPS připojen", `Přesnost: ${Math.round(position.coords.accuracy)}m`);
                },
                (error) => {
                    console.error("GPS error:", error);
                    showToast("GPS chyba", error.message, "destructive");
                },
                { enableHighAccuracy: true, timeout: 10000, maximumAge: 60000 }
            );
        }

        // Event listeners
        document.getElementById('startBtn').addEventListener('click', startTracking);
        document.getElementById('pauseBtn').addEventListener('click', pauseTracking);
        document.getElementById('stopBtn').addEventListener('click', stopTracking);
        document.getElementById('resetBtn').addEventListener('click', resetTracking);

        // Initialize
        initGPS();
        updateUI();
    </script>
</body>
</html>
